<!doctype html>
<html class="no-js" lang="ru">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Алфавитный указатель" href="genindex.html" /><link rel="search" title="Поиск" href="search.html" /><link rel="next" title="Twig изнутри" href="internals.html" /><link rel="prev" title="Twig для программистов" href="api.html" />

    <meta name="generator" content="sphinx-4.2.0, furo 2021.09.22"/>
        <title>Расширения в Twig - документация Twig 3.0</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=150e365fa939648e89c22f6d7d13c72a1657915a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=16fb25fabf47304eee183a5e9af80b1ba98259b1" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">документация Twig 3.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">документация Twig 3.0</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Поиск name="q" aria-label="Поиск">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Вступление</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Установка</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Twig для верстальщиков</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Twig для программистов</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Расширения в Twig</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Twig изнутри</a></li>
<li class="toctree-l1"><a class="reference internal" href="deprecated.html">Deprecated Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Примеры</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_standards.html">Стандарты кодирования</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tags/index.html">Tags</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="tags/apply.html"><code class="docutils literal notranslate"><span class="pre">apply</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/autoescape.html"><code class="docutils literal notranslate"><span class="pre">autoescape</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/block.html"><code class="docutils literal notranslate"><span class="pre">block</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/cache.html"><code class="docutils literal notranslate"><span class="pre">cache</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/deprecated.html"><code class="docutils literal notranslate"><span class="pre">deprecated</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/do.html"><code class="docutils literal notranslate"><span class="pre">do</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/embed.html"><code class="docutils literal notranslate"><span class="pre">embed</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/extends.html"><code class="docutils literal notranslate"><span class="pre">extends</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/flush.html"><code class="docutils literal notranslate"><span class="pre">flush</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/for.html"><code class="docutils literal notranslate"><span class="pre">for</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/from.html"><code class="docutils literal notranslate"><span class="pre">from</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/if.html"><code class="docutils literal notranslate"><span class="pre">if</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/import.html"><code class="docutils literal notranslate"><span class="pre">import</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/include.html"><code class="docutils literal notranslate"><span class="pre">include</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/macro.html"><code class="docutils literal notranslate"><span class="pre">macro</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/sandbox.html"><code class="docutils literal notranslate"><span class="pre">sandbox</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/set.html"><code class="docutils literal notranslate"><span class="pre">set</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/use.html"><code class="docutils literal notranslate"><span class="pre">use</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/verbatim.html"><code class="docutils literal notranslate"><span class="pre">verbatim</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tags/with.html"><code class="docutils literal notranslate"><span class="pre">with</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="filters/index.html">Filters</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="filters/abs.html"><code class="docutils literal notranslate"><span class="pre">abs</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/batch.html"><code class="docutils literal notranslate"><span class="pre">batch</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/capitalize.html"><code class="docutils literal notranslate"><span class="pre">capitalize</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/column.html"><code class="docutils literal notranslate"><span class="pre">column</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/convert_encoding.html"><code class="docutils literal notranslate"><span class="pre">convert_encoding</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/country_name.html"><code class="docutils literal notranslate"><span class="pre">country_name</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/currency_name.html"><code class="docutils literal notranslate"><span class="pre">currency_name</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/currency_symbol.html"><code class="docutils literal notranslate"><span class="pre">currency_symbol</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/data_uri.html"><code class="docutils literal notranslate"><span class="pre">data_uri</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/date.html"><code class="docutils literal notranslate"><span class="pre">date</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/date_modify.html"><code class="docutils literal notranslate"><span class="pre">date_modify</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/default.html"><code class="docutils literal notranslate"><span class="pre">default</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/escape.html"><code class="docutils literal notranslate"><span class="pre">escape</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/filter.html"><code class="docutils literal notranslate"><span class="pre">filter</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/first.html"><code class="docutils literal notranslate"><span class="pre">first</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/format.html"><code class="docutils literal notranslate"><span class="pre">format</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/format_currency.html"><code class="docutils literal notranslate"><span class="pre">format_currency</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/format_date.html"><code class="docutils literal notranslate"><span class="pre">format_date</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/format_datetime.html"><code class="docutils literal notranslate"><span class="pre">format_datetime</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/format_number.html"><code class="docutils literal notranslate"><span class="pre">format_number</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/format_time.html"><code class="docutils literal notranslate"><span class="pre">format_time</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/html_to_markdown.html"><code class="docutils literal notranslate"><span class="pre">html_to_markdown</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/inline_css.html"><code class="docutils literal notranslate"><span class="pre">inline_css</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/inky_to_html.html"><code class="docutils literal notranslate"><span class="pre">inky_to_html</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/join.html"><code class="docutils literal notranslate"><span class="pre">join</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/json_encode.html"><code class="docutils literal notranslate"><span class="pre">json_encode</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/keys.html"><code class="docutils literal notranslate"><span class="pre">keys</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/language_name.html"><code class="docutils literal notranslate"><span class="pre">language_name</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/last.html"><code class="docutils literal notranslate"><span class="pre">last</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/length.html"><code class="docutils literal notranslate"><span class="pre">length</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/locale_name.html"><code class="docutils literal notranslate"><span class="pre">locale_name</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/lower.html"><code class="docutils literal notranslate"><span class="pre">lower</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/map.html"><code class="docutils literal notranslate"><span class="pre">map</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/markdown_to_html.html"><code class="docutils literal notranslate"><span class="pre">markdown_to_html</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/merge.html"><code class="docutils literal notranslate"><span class="pre">merge</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/nl2br.html"><code class="docutils literal notranslate"><span class="pre">nl2br</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/number_format.html"><code class="docutils literal notranslate"><span class="pre">number_format</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/raw.html"><code class="docutils literal notranslate"><span class="pre">raw</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/reduce.html"><code class="docutils literal notranslate"><span class="pre">reduce</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/replace.html"><code class="docutils literal notranslate"><span class="pre">replace</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/reverse.html"><code class="docutils literal notranslate"><span class="pre">reverse</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/round.html"><code class="docutils literal notranslate"><span class="pre">round</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/slice.html"><code class="docutils literal notranslate"><span class="pre">slice</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/slug.html"><code class="docutils literal notranslate"><span class="pre">slug</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/sort.html"><code class="docutils literal notranslate"><span class="pre">sort</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/spaceless.html"><code class="docutils literal notranslate"><span class="pre">spaceless</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/split.html"><code class="docutils literal notranslate"><span class="pre">split</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/striptags.html"><code class="docutils literal notranslate"><span class="pre">striptags</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/timezone_name.html"><code class="docutils literal notranslate"><span class="pre">timezone_name</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/title.html"><code class="docutils literal notranslate"><span class="pre">title</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/trim.html"><code class="docutils literal notranslate"><span class="pre">trim</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/u.html"><code class="docutils literal notranslate"><span class="pre">u</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/upper.html"><code class="docutils literal notranslate"><span class="pre">upper</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="filters/url_encode.html"><code class="docutils literal notranslate"><span class="pre">url_encode</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="functions/index.html">Functions</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="functions/attribute.html"><code class="docutils literal notranslate"><span class="pre">attribute</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/block.html"><code class="docutils literal notranslate"><span class="pre">block</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/constant.html"><code class="docutils literal notranslate"><span class="pre">constant</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/cycle.html"><code class="docutils literal notranslate"><span class="pre">cycle</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/date.html"><code class="docutils literal notranslate"><span class="pre">date</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/dump.html"><code class="docutils literal notranslate"><span class="pre">dump</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/html_classes.html"><code class="docutils literal notranslate"><span class="pre">html_classes</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/include.html"><code class="docutils literal notranslate"><span class="pre">include</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/max.html"><code class="docutils literal notranslate"><span class="pre">max</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/min.html"><code class="docutils literal notranslate"><span class="pre">min</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/parent.html"><code class="docutils literal notranslate"><span class="pre">parent</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/random.html"><code class="docutils literal notranslate"><span class="pre">random</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/range.html"><code class="docutils literal notranslate"><span class="pre">range</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/source.html"><code class="docutils literal notranslate"><span class="pre">source</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/country_timezones.html"><code class="docutils literal notranslate"><span class="pre">country_timezones</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="functions/template_from_string.html"><code class="docutils literal notranslate"><span class="pre">template_from_string</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tests/index.html">Tests</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="tests/constant.html"><code class="docutils literal notranslate"><span class="pre">constant</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tests/defined.html"><code class="docutils literal notranslate"><span class="pre">defined</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tests/divisibleby.html"><code class="docutils literal notranslate"><span class="pre">divisible</span> <span class="pre">by</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tests/empty.html"><code class="docutils literal notranslate"><span class="pre">empty</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tests/even.html"><code class="docutils literal notranslate"><span class="pre">even</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tests/iterable.html"><code class="docutils literal notranslate"><span class="pre">iterable</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tests/null.html"><code class="docutils literal notranslate"><span class="pre">null</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tests/odd.html"><code class="docutils literal notranslate"><span class="pre">odd</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tests/sameas.html"><code class="docutils literal notranslate"><span class="pre">same</span> <span class="pre">as</span></code></a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="section" id="twig">
<h1>Расширения в Twig<a class="headerlink" href="#twig" title="Ссылка на этот заголовок">¶</a></h1>
<p>Twig can be extended in many ways; you can add extra tags, filters, tests,
operators, global variables, and functions. You can even extend the parser
itself with node visitors.</p>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>The first section of this chapter describes how to extend Twig. If you want
to reuse your changes in different projects or if you want to share them
with others, you should then create an extension as described in the
following section.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Осторожно</p>
<p>When extending Twig without creating an extension, Twig won’t be able to
recompile your templates when the PHP code is updated. To see your changes
in real-time, either disable template caching or package your code into an
extension (see the next section of this chapter).</p>
</div>
<p>Before extending Twig, you must understand the differences between all the
different possible extension points and when to use them.</p>
<p>First, remember that Twig has two main language constructs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">}}</span></code>: used to print the result of an expression evaluation;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">%}</span></code>: used to execute statements.</p></li>
</ul>
<p>To understand why Twig exposes so many extension points, let’s see how to
implement a <em>Lorem ipsum</em> generator (it needs to know the number of words to
generate).</p>
<p>You can use a <code class="docutils literal notranslate"><span class="pre">lipsum</span></code> <em>tag</em>:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">lipsum</span> <span class="m">40</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>That works, but using a tag for <code class="docutils literal notranslate"><span class="pre">lipsum</span></code> is not a good idea for at least
three main reasons:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lipsum</span></code> is not a language construct;</p></li>
<li><p>The tag outputs something;</p></li>
<li><p>The tag is not flexible as you cannot use it in an expression:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">'some text'</span> <span class="o">~</span> <span class="o">{%</span> <span class="nv">lipsum</span> <span class="m">40</span> <span class="o">%}</span> <span class="o">~</span> <span class="s1">'some more text'</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
</div>
</li>
</ul>
<p>In fact, you rarely need to create tags; and that’s good news because tags are
the most complex extension point.</p>
<p>Now, let’s use a <code class="docutils literal notranslate"><span class="pre">lipsum</span></code> <em>filter</em>:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="m">40</span><span class="o">|</span><span class="nf">lipsum</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
</div>
<p>Again, it works. But a filter should transform the passed value to something
else. Here, we use the value to indicate the number of words to generate (so,
<code class="docutils literal notranslate"><span class="pre">40</span></code> is an argument of the filter, not the value we want to transform).</p>
<p>Next, let’s use a <code class="docutils literal notranslate"><span class="pre">lipsum</span></code> <em>function</em>:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">lipsum</span><span class="o">(</span><span class="m">40</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
</div>
<p>Here we go. For this specific example, the creation of a function is the
extension point to use. And you can use it anywhere an expression is accepted:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">'some text'</span> <span class="o">~</span> <span class="nv">lipsum</span><span class="o">(</span><span class="m">40</span><span class="o">)</span> <span class="o">~</span> <span class="s1">'some more text'</span> <span class="cp">}}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">set</span> <span class="nv">lipsum</span> <span class="o">=</span> <span class="nv">lipsum</span><span class="o">(</span><span class="m">40</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>Lastly, you can also use a <em>global</em> object with a method able to generate lorem
ipsum text:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">text.lipsum</span><span class="o">(</span><span class="m">40</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
</div>
<p>As a rule of thumb, use functions for frequently used features and global
objects for everything else.</p>
<p>Keep in mind the following when you want to extend Twig:</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 14%"/>
<col style="width: 37%"/>
<col style="width: 14%"/>
<col style="width: 35%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>What?</p></th>
<th class="head"><p>Implementation difficulty?</p></th>
<th class="head"><p>How often?</p></th>
<th class="head"><p>When?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>macro</em></p></td>
<td><p>simple</p></td>
<td><p>frequent</p></td>
<td><p>Content generation</p></td>
</tr>
<tr class="row-odd"><td><p><em>global</em></p></td>
<td><p>simple</p></td>
<td><p>frequent</p></td>
<td><p>Helper object</p></td>
</tr>
<tr class="row-even"><td><p><em>function</em></p></td>
<td><p>simple</p></td>
<td><p>frequent</p></td>
<td><p>Content generation</p></td>
</tr>
<tr class="row-odd"><td><p><em>filter</em></p></td>
<td><p>simple</p></td>
<td><p>frequent</p></td>
<td><p>Value transformation</p></td>
</tr>
<tr class="row-even"><td><p><em>tag</em></p></td>
<td><p>complex</p></td>
<td><p>rare</p></td>
<td><p>DSL language construct</p></td>
</tr>
<tr class="row-odd"><td><p><em>test</em></p></td>
<td><p>simple</p></td>
<td><p>rare</p></td>
<td><p>Boolean decision</p></td>
</tr>
<tr class="row-even"><td><p><em>operator</em></p></td>
<td><p>simple</p></td>
<td><p>rare</p></td>
<td><p>Values transformation</p></td>
</tr>
</tbody>
</table></div>
<div class="section" id="globals">
<h2>Globals<a class="headerlink" href="#globals" title="Ссылка на этот заголовок">¶</a></h2>
<p>A global variable is like any other template variable, except that it’s
available in all templates and macros:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$twig = new \Twig\Environment($loader);
$twig-&gt;addGlobal('text', new Text());
</pre></div>
</div>
<p>You can then use the <code class="docutils literal notranslate"><span class="pre">text</span></code> variable anywhere in a template:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">text.lipsum</span><span class="o">(</span><span class="m">40</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="filters">
<h2>Filters<a class="headerlink" href="#filters" title="Ссылка на этот заголовок">¶</a></h2>
<p>Creating a filter consists of associating a name with a PHP callable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// an anonymous function
$filter = new \Twig\TwigFilter('rot13', function ($string) {
    return str_rot13($string);
});

// or a simple PHP function
$filter = new \Twig\TwigFilter('rot13', 'str_rot13');

// or a class static method
$filter = new \Twig\TwigFilter('rot13', ['SomeClass', 'rot13Filter']);
$filter = new \Twig\TwigFilter('rot13', 'SomeClass::rot13Filter');

// or a class method
$filter = new \Twig\TwigFilter('rot13', [$this, 'rot13Filter']);
// the one below needs a runtime implementation (see below for more information)
$filter = new \Twig\TwigFilter('rot13', ['SomeClass', 'rot13Filter']);
</pre></div>
</div>
<p>The first argument passed to the <code class="docutils literal notranslate"><span class="pre">\Twig\TwigFilter</span></code> constructor is the name of the
filter you will use in templates and the second one is the PHP callable to
associate with it.</p>
<p>Then, add the filter to the Twig environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$twig = new \Twig\Environment($loader);
$twig-&gt;addFilter($filter);
</pre></div>
</div>
<p>And here is how to use it in a template:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">'Twig'</span><span class="o">|</span><span class="nf">rot13</span> <span class="cp">}}</span><span class="x"></span>

<span class="c">{# will output Gjvt #}</span><span class="x"></span>
</pre></div>
</div>
<p>When called by Twig, the PHP callable receives the left side of the filter
(before the pipe <code class="docutils literal notranslate"><span class="pre">|</span></code>) as the first argument and the extra arguments passed
to the filter (within parentheses <code class="docutils literal notranslate"><span class="pre">()</span></code>) as extra arguments.</p>
<p>For instance, the following code:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">'TWIG'</span><span class="o">|</span><span class="nf">lower</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">now</span><span class="o">|</span><span class="nf">date</span><span class="o">(</span><span class="s1">'d/m/Y'</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
</div>
<p>is compiled to something like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?php echo strtolower('TWIG') ?&gt;
&lt;?php echo twig_date_format_filter($now, 'd/m/Y') ?&gt;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">\Twig\TwigFilter</span></code> class takes an array of options as its last argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$filter = new \Twig\TwigFilter('rot13', 'str_rot13', $options);
</pre></div>
</div>
<div class="section" id="environment-aware-filters">
<h3>Environment-aware Filters<a class="headerlink" href="#environment-aware-filters" title="Ссылка на этот заголовок">¶</a></h3>
<p>If you want to access the current environment instance in your filter, set the
<code class="docutils literal notranslate"><span class="pre">needs_environment</span></code> option to <code class="docutils literal notranslate"><span class="pre">true</span></code>; Twig will pass the current
environment as the first argument to the filter call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$filter = new \Twig\TwigFilter('rot13', function (\Twig\Environment $env, $string) {
    // get the current charset for instance
    $charset = $env-&gt;getCharset();

    return str_rot13($string);
}, ['needs_environment' =&gt; true]);
</pre></div>
</div>
</div>
<div class="section" id="context-aware-filters">
<h3>Context-aware Filters<a class="headerlink" href="#context-aware-filters" title="Ссылка на этот заголовок">¶</a></h3>
<p>If you want to access the current context in your filter, set the
<code class="docutils literal notranslate"><span class="pre">needs_context</span></code> option to <code class="docutils literal notranslate"><span class="pre">true</span></code>; Twig will pass the current context as
the first argument to the filter call (or the second one if
<code class="docutils literal notranslate"><span class="pre">needs_environment</span></code> is also set to <code class="docutils literal notranslate"><span class="pre">true</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$filter = new \Twig\TwigFilter('rot13', function ($context, $string) {
    // ...
}, ['needs_context' =&gt; true]);

$filter = new \Twig\TwigFilter('rot13', function (\Twig\Environment $env, $context, $string) {
    // ...
}, ['needs_context' =&gt; true, 'needs_environment' =&gt; true]);
</pre></div>
</div>
</div>
<div class="section" id="automatic-escaping">
<h3>Automatic Escaping<a class="headerlink" href="#automatic-escaping" title="Ссылка на этот заголовок">¶</a></h3>
<p>If automatic escaping is enabled, the output of the filter may be escaped
before printing. If your filter acts as an escaper (or explicitly outputs HTML
or JavaScript code), you will want the raw output to be printed. In such a
case, set the <code class="docutils literal notranslate"><span class="pre">is_safe</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$filter = new \Twig\TwigFilter('nl2br', 'nl2br', ['is_safe' =&gt; ['html']]);
</pre></div>
</div>
<p>Some filters may need to work on input that is already escaped or safe, for
example when adding (safe) HTML tags to originally unsafe output. In such a
case, set the <code class="docutils literal notranslate"><span class="pre">pre_escape</span></code> option to escape the input data before it is run
through your filter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$filter = new \Twig\TwigFilter('somefilter', 'somefilter', ['pre_escape' =&gt; 'html', 'is_safe' =&gt; ['html']]);
</pre></div>
</div>
</div>
<div class="section" id="variadic-filters">
<h3>Variadic Filters<a class="headerlink" href="#variadic-filters" title="Ссылка на этот заголовок">¶</a></h3>
<p>When a filter should accept an arbitrary number of arguments, set the
<code class="docutils literal notranslate"><span class="pre">is_variadic</span></code> option to <code class="docutils literal notranslate"><span class="pre">true</span></code>; Twig will pass the extra arguments as the
last argument to the filter call as an array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$filter = new \Twig\TwigFilter('thumbnail', function ($file, array $options = []) {
    // ...
}, ['is_variadic' =&gt; true]);
</pre></div>
</div>
<p>Be warned that <a class="reference internal" href="templates.html#named-arguments"><span class="std std-ref">named arguments</span></a> passed to a variadic
filter cannot be checked for validity as they will automatically end up in the
option array.</p>
</div>
<div class="section" id="dynamic-filters">
<h3>Dynamic Filters<a class="headerlink" href="#dynamic-filters" title="Ссылка на этот заголовок">¶</a></h3>
<p>A filter name containing the special <code class="docutils literal notranslate"><span class="pre">*</span></code> character is a dynamic filter and
the <code class="docutils literal notranslate"><span class="pre">*</span></code> part will match any string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$filter = new \Twig\TwigFilter('*_path', function ($name, $arguments) {
    // ...
});
</pre></div>
</div>
<p>The following filters are matched by the above defined dynamic filter:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">product_path</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">category_path</span></code></p></li>
</ul>
<p>A dynamic filter can define more than one dynamic parts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$filter = new \Twig\TwigFilter('*_path_*', function ($name, $suffix, $arguments) {
    // ...
});
</pre></div>
</div>
<p>The filter receives all dynamic part values before the normal filter arguments,
but after the environment and the context. For instance, a call to
<code class="docutils literal notranslate"><span class="pre">'foo'|a_path_b()</span></code> will result in the following arguments to be passed to the
filter: <code class="docutils literal notranslate"><span class="pre">('a',</span> <span class="pre">'b',</span> <span class="pre">'foo')</span></code>.</p>
</div>
<div class="section" id="deprecated-filters">
<h3>Deprecated Filters<a class="headerlink" href="#deprecated-filters" title="Ссылка на этот заголовок">¶</a></h3>
<p>You can mark a filter as being deprecated by setting the <code class="docutils literal notranslate"><span class="pre">deprecated</span></code> option
to <code class="docutils literal notranslate"><span class="pre">true</span></code>. You can also give an alternative filter that replaces the
deprecated one when that makes sense:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$filter = new \Twig\TwigFilter('obsolete', function () {
    // ...
}, ['deprecated' =&gt; true, 'alternative' =&gt; 'new_one']);
</pre></div>
</div>
<p>When a filter is deprecated, Twig emits a deprecation notice when compiling a
template using it. See <a class="reference internal" href="recipes.html#deprecation-notices"><span class="std std-ref">Displaying Deprecation Notices</span></a> for more information.</p>
</div>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Ссылка на этот заголовок">¶</a></h2>
<p>Functions are defined in the exact same way as filters, but you need to create
an instance of <code class="docutils literal notranslate"><span class="pre">\Twig\TwigFunction</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$twig = new \Twig\Environment($loader);
$function = new \Twig\TwigFunction('function_name', function () {
    // ...
});
$twig-&gt;addFunction($function);
</pre></div>
</div>
<p>Functions support the same features as filters, except for the <code class="docutils literal notranslate"><span class="pre">pre_escape</span></code>
and <code class="docutils literal notranslate"><span class="pre">preserves_safety</span></code> options.</p>
</div>
<div class="section" id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Ссылка на этот заголовок">¶</a></h2>
<p>Tests are defined in the exact same way as filters and functions, but you need
to create an instance of <code class="docutils literal notranslate"><span class="pre">\Twig\TwigTest</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$twig = new \Twig\Environment($loader);
$test = new \Twig\TwigTest('test_name', function () {
    // ...
});
$twig-&gt;addTest($test);
</pre></div>
</div>
<p>Tests allow you to create custom application specific logic for evaluating
boolean conditions. As a simple example, let’s create a Twig test that checks if
objects are „red“:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$twig = new \Twig\Environment($loader);
$test = new \Twig\TwigTest('red', function ($value) {
    if (isset($value-&gt;color) &amp;&amp; $value-&gt;color == 'red') {
        return true;
    }
    if (isset($value-&gt;paint) &amp;&amp; $value-&gt;paint == 'red') {
        return true;
    }
    return false;
});
$twig-&gt;addTest($test);
</pre></div>
</div>
<p>Test functions must always return <code class="docutils literal notranslate"><span class="pre">true</span></code>/<code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>When creating tests you can use the <code class="docutils literal notranslate"><span class="pre">node_class</span></code> option to provide custom test
compilation. This is useful if your test can be compiled into PHP primitives.
This is used by many of the tests built into Twig:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>namespace App;

use Twig\Environment;
use Twig\Node\Expression\TestExpression;
use Twig\TwigTest;

$twig = new Environment($loader);
$test = new TwigTest(
    'odd',
    null,
    ['node_class' =&gt; OddTestExpression::class]);
$twig-&gt;addTest($test);

class OddTestExpression extends TestExpression
{
    public function compile(\Twig\Compiler $compiler)
    {
        $compiler
            -&gt;raw('(')
            -&gt;subcompile($this-&gt;getNode('node'))
            -&gt;raw(' % 2 != 0')
            -&gt;raw(')')
        ;
    }
}
</pre></div>
</div>
<p>The above example shows how you can create tests that use a node class. The node
class has access to one sub-node called <code class="docutils literal notranslate"><span class="pre">node</span></code>. This sub-node contains the
value that is being tested. When the <code class="docutils literal notranslate"><span class="pre">odd</span></code> filter is used in code such as:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">my_value</span> <span class="k">is</span> <span class="nf">odd</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">node</span></code> sub-node will contain an expression of <code class="docutils literal notranslate"><span class="pre">my_value</span></code>. Node-based
tests also have access to the <code class="docutils literal notranslate"><span class="pre">arguments</span></code> node. This node will contain the
various other arguments that have been provided to your test.</p>
<p>If you want to pass a variable number of positional or named arguments to the
test, set the <code class="docutils literal notranslate"><span class="pre">is_variadic</span></code> option to <code class="docutils literal notranslate"><span class="pre">true</span></code>. Tests support dynamic
names (see dynamic filters for the syntax).</p>
</div>
<div class="section" id="tags">
<h2>Tags<a class="headerlink" href="#tags" title="Ссылка на этот заголовок">¶</a></h2>
<p>One of the most exciting features of a template engine like Twig is the
possibility to define new <strong>language constructs</strong>. This is also the most complex
feature as you need to understand how Twig’s internals work.</p>
<p>Most of the time though, a tag is not needed:</p>
<ul>
<li><p>If your tag generates some output, use a <strong>function</strong> instead.</p></li>
<li><p>If your tag modifies some content and returns it, use a <strong>filter</strong> instead.</p>
<p>For instance, if you want to create a tag that converts a Markdown formatted
text to HTML, create a <code class="docutils literal notranslate"><span class="pre">markdown</span></code> filter instead:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">'**markdown** text'</span><span class="o">|</span><span class="nf">markdown</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
</div>
<p>If you want use this filter on large amounts of text, wrap it with the
<a class="reference internal" href="tags/apply.html"><span class="doc">apply</span></a> tag:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">apply</span> <span class="nv">markdown</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">Title</span>
<span class="x">=====</span>

<span class="x">Much better than creating a tag as you can **compose** filters.</span>
<span class="cp">{%</span> <span class="k">endapply</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</li>
<li><p>If your tag does not output anything, but only exists because of a side
effect, create a <strong>function</strong> that returns nothing and call it via the
<a class="reference internal" href="tags/do.html"><span class="doc">filter</span></a> tag.</p>
<p>For instance, if you want to create a tag that logs text, create a <code class="docutils literal notranslate"><span class="pre">log</span></code>
function instead and call it via the <a class="reference internal" href="tags/do.html"><span class="doc">do</span></a> tag:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">do</span> <span class="nv">log</span><span class="o">(</span><span class="s1">'Log some things'</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</li>
</ul>
<p>If you still want to create a tag for a new language construct, great!</p>
<p>Let’s create a <code class="docutils literal notranslate"><span class="pre">set</span></code> tag that allows the definition of simple variables from
within a template. The tag can be used like follows:</p>
<div class="highlight-twig notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">set</span> <span class="nv">name</span> <span class="o">=</span> <span class="s2">"value"</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span><span class="x"></span>

<span class="c">{# should output value #}</span><span class="x"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>The <code class="docutils literal notranslate"><span class="pre">set</span></code> tag is part of the Core extension and as such is always
available. The built-in version is slightly more powerful and supports
multiple assignments by default.</p>
</div>
<p>Three steps are needed to define a new tag:</p>
<ul class="simple">
<li><p>Defining a Token Parser class (responsible for parsing the template code);</p></li>
<li><p>Defining a Node class (responsible for converting the parsed code to PHP);</p></li>
<li><p>Registering the tag.</p></li>
</ul>
<div class="section" id="registering-a-new-tag">
<h3>Registering a new tag<a class="headerlink" href="#registering-a-new-tag" title="Ссылка на этот заголовок">¶</a></h3>
<p>Add a tag by calling the <code class="docutils literal notranslate"><span class="pre">addTokenParser</span></code> method on the <code class="docutils literal notranslate"><span class="pre">\Twig\Environment</span></code>
instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$twig = new \Twig\Environment($loader);
$twig-&gt;addTokenParser(new Project_Set_TokenParser());
</pre></div>
</div>
</div>
<div class="section" id="defining-a-token-parser">
<h3>Defining a Token Parser<a class="headerlink" href="#defining-a-token-parser" title="Ссылка на этот заголовок">¶</a></h3>
<p>Now, let’s see the actual code of this class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class Project_Set_TokenParser extends \Twig\TokenParser\AbstractTokenParser
{
    public function parse(\Twig\Token $token)
    {
        $parser = $this-&gt;parser;
        $stream = $parser-&gt;getStream();

        $name = $stream-&gt;expect(\Twig\Token::NAME_TYPE)-&gt;getValue();
        $stream-&gt;expect(\Twig\Token::OPERATOR_TYPE, '=');
        $value = $parser-&gt;getExpressionParser()-&gt;parseExpression();
        $stream-&gt;expect(\Twig\Token::BLOCK_END_TYPE);

        return new Project_Set_Node($name, $value, $token-&gt;getLine(), $this-&gt;getTag());
    }

    public function getTag()
    {
        return 'set';
    }
}
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">getTag()</span></code> method must return the tag we want to parse, here <code class="docutils literal notranslate"><span class="pre">set</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">parse()</span></code> method is invoked whenever the parser encounters a <code class="docutils literal notranslate"><span class="pre">set</span></code>
tag. It should return a <code class="docutils literal notranslate"><span class="pre">\Twig\Node\Node</span></code> instance that represents the node (the
<code class="docutils literal notranslate"><span class="pre">Project_Set_Node</span></code> calls creating is explained in the next section).</p>
<p>The parsing process is simplified thanks to a bunch of methods you can call
from the token stream (<code class="docutils literal notranslate"><span class="pre">$this-&gt;parser-&gt;getStream()</span></code>):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrent()</span></code>: Gets the current token in the stream.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next()</span></code>: Moves to the next token in the stream, <em>but returns the old one</em>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test($type)</span></code>, <code class="docutils literal notranslate"><span class="pre">test($value)</span></code> or <code class="docutils literal notranslate"><span class="pre">test($type,</span> <span class="pre">$value)</span></code>: Determines whether
the current token is of a particular type or value (or both). The value may be an
array of several possible values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expect($type[,</span> <span class="pre">$value[,</span> <span class="pre">$message]])</span></code>: If the current token isn’t of the given
type/value a syntax error is thrown. Otherwise, if the type and value are correct,
the token is returned and the stream moves to the next token.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">look()</span></code>: Looks at the next token without consuming it.</p></li>
</ul>
<p>Parsing expressions is done by calling the <code class="docutils literal notranslate"><span class="pre">parseExpression()</span></code> like we did for
the <code class="docutils literal notranslate"><span class="pre">set</span></code> tag.</p>
<div class="admonition tip">
<p class="admonition-title">Совет</p>
<p>Reading the existing <code class="docutils literal notranslate"><span class="pre">TokenParser</span></code> classes is the best way to learn all
the nitty-gritty details of the parsing process.</p>
</div>
</div>
<div class="section" id="defining-a-node">
<h3>Defining a Node<a class="headerlink" href="#defining-a-node" title="Ссылка на этот заголовок">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Project_Set_Node</span></code> class itself is quite short:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class Project_Set_Node extends \Twig\Node\Node
{
    public function __construct($name, \Twig\Node\Expression\AbstractExpression $value, $line, $tag = null)
    {
        parent::__construct(['value' =&gt; $value], ['name' =&gt; $name], $line, $tag);
    }

    public function compile(\Twig\Compiler $compiler)
    {
        $compiler
            -&gt;addDebugInfo($this)
            -&gt;write('$context[\''.$this-&gt;getAttribute('name').'\'] = ')
            -&gt;subcompile($this-&gt;getNode('value'))
            -&gt;raw(";\n")
        ;
    }
}
</pre></div>
</div>
<p>The compiler implements a fluid interface and provides methods that helps the
developer generate beautiful and readable PHP code:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">subcompile()</span></code>: Compiles a node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">raw()</span></code>: Writes the given string as is.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">write()</span></code>: Writes the given string by adding indentation at the beginning
of each line.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">string()</span></code>: Writes a quoted string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">repr()</span></code>: Writes a PHP representation of a given value (see
<code class="docutils literal notranslate"><span class="pre">\Twig\Node\ForNode</span></code> for a usage example).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">addDebugInfo()</span></code>: Adds the line of the original template file related to
the current node as a comment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">indent()</span></code>: Indents the generated code (see <code class="docutils literal notranslate"><span class="pre">\Twig\Node\BlockNode</span></code> for a
usage example).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outdent()</span></code>: Outdents the generated code (see <code class="docutils literal notranslate"><span class="pre">\Twig\Node\BlockNode</span></code> for a
usage example).</p></li>
</ul>
</div>
</div>
<div class="section" id="creating-an-extension">
<span id="creating-extensions"></span><h2>Creating an Extension<a class="headerlink" href="#creating-an-extension" title="Ссылка на этот заголовок">¶</a></h2>
<p>The main motivation for writing an extension is to move often used code into a
reusable class like adding support for internationalization. An extension can
define tags, filters, tests, operators, functions, and node visitors.</p>
<p>Most of the time, it is useful to create a single extension for your project,
to host all the specific tags and filters you want to add to Twig.</p>
<div class="admonition tip">
<p class="admonition-title">Совет</p>
<p>When packaging your code into an extension, Twig is smart enough to
recompile your templates whenever you make a change to it (when
<code class="docutils literal notranslate"><span class="pre">auto_reload</span></code> is enabled).</p>
</div>
<p>An extension is a class that implements the following interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> \<span class="n">Twig</span>\<span class="n">Extension</span>\<span class="n">ExtensionInterface</span>
<span class="p">{</span>
    <span class="o">/**</span>
     <span class="o">*</span> <span class="n">Returns</span> <span class="n">the</span> <span class="n">token</span> <span class="n">parser</span> <span class="n">instances</span> <span class="n">to</span> <span class="n">add</span> <span class="n">to</span> <span class="n">the</span> <span class="n">existing</span> <span class="nb">list</span><span class="o">.</span>
     <span class="o">*</span>
     <span class="o">*</span> <span class="nd">@return</span> \<span class="n">Twig</span>\<span class="n">TokenParser</span>\<span class="n">TokenParserInterface</span><span class="p">[]</span>
     <span class="o">*/</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getTokenParsers</span><span class="p">();</span>

    <span class="o">/**</span>
     <span class="o">*</span> <span class="n">Returns</span> <span class="n">the</span> <span class="n">node</span> <span class="n">visitor</span> <span class="n">instances</span> <span class="n">to</span> <span class="n">add</span> <span class="n">to</span> <span class="n">the</span> <span class="n">existing</span> <span class="nb">list</span><span class="o">.</span>
     <span class="o">*</span>
     <span class="o">*</span> <span class="nd">@return</span> \<span class="n">Twig</span>\<span class="n">NodeVisitor</span>\<span class="n">NodeVisitorInterface</span><span class="p">[]</span>
     <span class="o">*/</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getNodeVisitors</span><span class="p">();</span>

    <span class="o">/**</span>
     <span class="o">*</span> <span class="n">Returns</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">filters</span> <span class="n">to</span> <span class="n">add</span> <span class="n">to</span> <span class="n">the</span> <span class="n">existing</span> <span class="nb">list</span><span class="o">.</span>
     <span class="o">*</span>
     <span class="o">*</span> <span class="nd">@return</span> \<span class="n">Twig</span>\<span class="n">TwigFilter</span><span class="p">[]</span>
     <span class="o">*/</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getFilters</span><span class="p">();</span>

    <span class="o">/**</span>
     <span class="o">*</span> <span class="n">Returns</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">tests</span> <span class="n">to</span> <span class="n">add</span> <span class="n">to</span> <span class="n">the</span> <span class="n">existing</span> <span class="nb">list</span><span class="o">.</span>
     <span class="o">*</span>
     <span class="o">*</span> <span class="nd">@return</span> \<span class="n">Twig</span>\<span class="n">TwigTest</span><span class="p">[]</span>
     <span class="o">*/</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getTests</span><span class="p">();</span>

    <span class="o">/**</span>
     <span class="o">*</span> <span class="n">Returns</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">functions</span> <span class="n">to</span> <span class="n">add</span> <span class="n">to</span> <span class="n">the</span> <span class="n">existing</span> <span class="nb">list</span><span class="o">.</span>
     <span class="o">*</span>
     <span class="o">*</span> <span class="nd">@return</span> \<span class="n">Twig</span>\<span class="n">TwigFunction</span><span class="p">[]</span>
     <span class="o">*/</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getFunctions</span><span class="p">();</span>

    <span class="o">/**</span>
     <span class="o">*</span> <span class="n">Returns</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">operators</span> <span class="n">to</span> <span class="n">add</span> <span class="n">to</span> <span class="n">the</span> <span class="n">existing</span> <span class="nb">list</span><span class="o">.</span>
     <span class="o">*</span>
     <span class="o">*</span> <span class="nd">@return</span> <span class="n">array</span><span class="o">&lt;</span><span class="n">array</span><span class="o">&gt;</span> <span class="n">First</span> <span class="n">array</span> <span class="n">of</span> <span class="n">unary</span> <span class="n">operators</span><span class="p">,</span> <span class="n">second</span> <span class="n">array</span> <span class="n">of</span> <span class="n">binary</span> <span class="n">operators</span>
     <span class="o">*/</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getOperators</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To keep your extension class clean and lean, inherit from the built-in
<code class="docutils literal notranslate"><span class="pre">\Twig\Extension\AbstractExtension</span></code> class instead of implementing the interface as it provides
empty implementations for all methods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Project_Twig_Extension</span> <span class="n">extends</span> \<span class="n">Twig</span>\<span class="n">Extension</span>\<span class="n">AbstractExtension</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This extension does nothing for now. We will customize it in the next sections.</p>
<p>You can save your extension anywhere on the filesystem, as all extensions must
be registered explicitly to be available in your templates.</p>
<p>You can register an extension by using the <code class="docutils literal notranslate"><span class="pre">addExtension()</span></code> method on your
main <code class="docutils literal notranslate"><span class="pre">Environment</span></code> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$twig = new \Twig\Environment($loader);
$twig-&gt;addExtension(new Project_Twig_Extension());
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Совет</p>
<p>The Twig core extensions are great examples of how extensions work.</p>
</div>
<div class="section" id="id1">
<h3>Globals<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h3>
<p>Global variables can be registered in an extension via the <code class="docutils literal notranslate"><span class="pre">getGlobals()</span></code>
method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Project_Twig_Extension</span> <span class="n">extends</span> \<span class="n">Twig</span>\<span class="n">Extension</span>\<span class="n">AbstractExtension</span> <span class="n">implements</span> \<span class="n">Twig</span>\<span class="n">Extension</span>\<span class="n">GlobalsInterface</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getGlobals</span><span class="p">():</span> <span class="n">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'text'</span> <span class="o">=&gt;</span> <span class="n">new</span> <span class="n">Text</span><span class="p">(),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>Functions<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h3>
<p>Functions can be registered in an extension via the <code class="docutils literal notranslate"><span class="pre">getFunctions()</span></code>
method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Project_Twig_Extension</span> <span class="n">extends</span> \<span class="n">Twig</span>\<span class="n">Extension</span>\<span class="n">AbstractExtension</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getFunctions</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">new</span> \<span class="n">Twig</span>\<span class="n">TwigFunction</span><span class="p">(</span><span class="s1">'lipsum'</span><span class="p">,</span> <span class="s1">'generate_lipsum'</span><span class="p">),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>Filters<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h3>
<p>To add a filter to an extension, you need to override the <code class="docutils literal notranslate"><span class="pre">getFilters()</span></code>
method. This method must return an array of filters to add to the Twig
environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Project_Twig_Extension</span> <span class="n">extends</span> \<span class="n">Twig</span>\<span class="n">Extension</span>\<span class="n">AbstractExtension</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getFilters</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">new</span> \<span class="n">Twig</span>\<span class="n">TwigFilter</span><span class="p">(</span><span class="s1">'rot13'</span><span class="p">,</span> <span class="s1">'str_rot13'</span><span class="p">),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>Tags<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h3>
<p>Adding a tag in an extension can be done by overriding the
<code class="docutils literal notranslate"><span class="pre">getTokenParsers()</span></code> method. This method must return an array of tags to add
to the Twig environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Project_Twig_Extension</span> <span class="n">extends</span> \<span class="n">Twig</span>\<span class="n">Extension</span>\<span class="n">AbstractExtension</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getTokenParsers</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">new</span> <span class="n">Project_Set_TokenParser</span><span class="p">()];</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the above code, we have added a single new tag, defined by the
<code class="docutils literal notranslate"><span class="pre">Project_Set_TokenParser</span></code> class. The <code class="docutils literal notranslate"><span class="pre">Project_Set_TokenParser</span></code> class is
responsible for parsing the tag and compiling it to PHP.</p>
</div>
<div class="section" id="operators">
<h3>Operators<a class="headerlink" href="#operators" title="Ссылка на этот заголовок">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">getOperators()</span></code> methods lets you add new operators. Here is how to add
the <code class="docutils literal notranslate"><span class="pre">!</span></code>, <code class="docutils literal notranslate"><span class="pre">||</span></code>, and <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> operators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Project_Twig_Extension</span> <span class="n">extends</span> \<span class="n">Twig</span>\<span class="n">Extension</span>\<span class="n">AbstractExtension</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getOperators</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s1">'!'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'precedence'</span> <span class="o">=&gt;</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">'class'</span> <span class="o">=&gt;</span> \<span class="n">Twig</span>\<span class="n">Node</span>\<span class="n">Expression</span>\<span class="n">Unary</span>\<span class="n">NotUnary</span><span class="p">::</span><span class="n">class</span><span class="p">],</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="s1">'||'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'precedence'</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">'class'</span> <span class="o">=&gt;</span> \<span class="n">Twig</span>\<span class="n">Node</span>\<span class="n">Expression</span>\<span class="n">Binary</span>\<span class="n">OrBinary</span><span class="p">::</span><span class="n">class</span><span class="p">,</span> <span class="s1">'associativity'</span> <span class="o">=&gt;</span> \<span class="n">Twig</span>\<span class="n">ExpressionParser</span><span class="p">::</span><span class="n">OPERATOR_LEFT</span><span class="p">],</span>
                <span class="s1">'&amp;&amp;'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'precedence'</span> <span class="o">=&gt;</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">'class'</span> <span class="o">=&gt;</span> \<span class="n">Twig</span>\<span class="n">Node</span>\<span class="n">Expression</span>\<span class="n">Binary</span>\<span class="n">AndBinary</span><span class="p">::</span><span class="n">class</span><span class="p">,</span> <span class="s1">'associativity'</span> <span class="o">=&gt;</span> \<span class="n">Twig</span>\<span class="n">ExpressionParser</span><span class="p">::</span><span class="n">OPERATOR_LEFT</span><span class="p">],</span>
            <span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>Tests<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">getTests()</span></code> method lets you add new test functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Project_Twig_Extension</span> <span class="n">extends</span> \<span class="n">Twig</span>\<span class="n">Extension</span>\<span class="n">AbstractExtension</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getTests</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">new</span> \<span class="n">Twig</span>\<span class="n">TwigTest</span><span class="p">(</span><span class="s1">'even'</span><span class="p">,</span> <span class="s1">'twig_test_even'</span><span class="p">),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="definition-vs-runtime">
<h3>Definition vs Runtime<a class="headerlink" href="#definition-vs-runtime" title="Ссылка на этот заголовок">¶</a></h3>
<p>Twig filters, functions, and tests runtime implementations can be defined as
any valid PHP callable:</p>
<ul class="simple">
<li><p><strong>functions/static methods</strong>: Simple to implement and fast (used by all Twig
core extensions); but it is hard for the runtime to depend on external
objects;</p></li>
<li><p><strong>closures</strong>: Simple to implement;</p></li>
<li><p><strong>object methods</strong>: More flexible and required if your runtime code depends
on external objects.</p></li>
</ul>
<p>The simplest way to use methods is to define them on the extension itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class Project_Twig_Extension extends \Twig\Extension\AbstractExtension
{
    private $rot13Provider;

    public function __construct($rot13Provider)
    {
        $this-&gt;rot13Provider = $rot13Provider;
    }

    public function getFunctions()
    {
        return [
            new \Twig\TwigFunction('rot13', [$this, 'rot13']),
        ];
    }

    public function rot13($value)
    {
        return $this-&gt;rot13Provider-&gt;rot13($value);
    }
}
</pre></div>
</div>
<p>This is very convenient but not recommended as it makes template compilation
depend on runtime dependencies even if they are not needed (think for instance
as a dependency that connects to a database engine).</p>
<p>You can decouple the extension definitions from their runtime implementations by
registering a <code class="docutils literal notranslate"><span class="pre">\Twig\RuntimeLoader\RuntimeLoaderInterface</span></code> instance on the
environment that knows how to instantiate such runtime classes (runtime classes
must be autoload-able):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class RuntimeLoader implements \Twig\RuntimeLoader\RuntimeLoaderInterface
{
    public function load($class)
    {
        // implement the logic to create an instance of $class
        // and inject its dependencies
        // most of the time, it means using your dependency injection container
        if ('Project_Twig_RuntimeExtension' === $class) {
            return new $class(new Rot13Provider());
        } else {
            // ...
        }
    }
}

$twig-&gt;addRuntimeLoader(new RuntimeLoader());
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>Twig comes with a PSR-11 compatible runtime loader
(<code class="docutils literal notranslate"><span class="pre">\Twig\RuntimeLoader\ContainerRuntimeLoader</span></code>).</p>
</div>
<p>It is now possible to move the runtime logic to a new
<code class="docutils literal notranslate"><span class="pre">Project_Twig_RuntimeExtension</span></code> class and use it directly in the extension:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class Project_Twig_RuntimeExtension
{
    private $rot13Provider;

    public function __construct($rot13Provider)
    {
        $this-&gt;rot13Provider = $rot13Provider;
    }

    public function rot13($value)
    {
        return $this-&gt;rot13Provider-&gt;rot13($value);
    }
}

class Project_Twig_Extension extends \Twig\Extension\AbstractExtension
{
    public function getFunctions()
    {
        return [
            new \Twig\TwigFunction('rot13', ['Project_Twig_RuntimeExtension', 'rot13']),
            // or
            new \Twig\TwigFunction('rot13', 'Project_Twig_RuntimeExtension::rot13'),
        ];
    }
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="testing-an-extension">
<h2>Testing an Extension<a class="headerlink" href="#testing-an-extension" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="functional-tests">
<h3>Functional Tests<a class="headerlink" href="#functional-tests" title="Ссылка на этот заголовок">¶</a></h3>
<p>You can create functional tests for extensions by creating the following file
structure in your test directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Fixtures</span><span class="o">/</span>
    <span class="n">filters</span><span class="o">/</span>
        <span class="n">foo</span><span class="o">.</span><span class="n">test</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">test</span>
    <span class="n">functions</span><span class="o">/</span>
        <span class="n">foo</span><span class="o">.</span><span class="n">test</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">test</span>
    <span class="n">tags</span><span class="o">/</span>
        <span class="n">foo</span><span class="o">.</span><span class="n">test</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">test</span>
<span class="n">IntegrationTest</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">IntegrationTest.php</span></code> file should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">Twig</span>\<span class="n">Test</span>\<span class="n">IntegrationTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Project_Tests_IntegrationTest</span> <span class="n">extends</span> <span class="n">IntegrationTestCase</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">function</span> <span class="n">getExtensions</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">new</span> <span class="n">Project_Twig_Extension1</span><span class="p">(),</span>
            <span class="n">new</span> <span class="n">Project_Twig_Extension2</span><span class="p">(),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">getFixturesDir</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">__DIR__</span><span class="o">.</span><span class="s1">'/Fixtures/'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Fixtures examples can be found within the Twig repository
<a class="reference external" href="https://github.com/twigphp/Twig/tree/3.x/tests/Fixtures">tests/Twig/Fixtures</a> directory.</p>
</div>
<div class="section" id="node-tests">
<h3>Node Tests<a class="headerlink" href="#node-tests" title="Ссылка на этот заголовок">¶</a></h3>
<p>Testing the node visitors can be complex, so extend your test cases from
<code class="docutils literal notranslate"><span class="pre">\Twig\Test\NodeTestCase</span></code>. Examples can be found in the Twig repository
<a class="reference external" href="https://github.com/twigphp/Twig/tree/3.x/tests/Node">tests/Twig/Node</a> directory.</p>
</div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="internals.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Twig изнутри</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="api.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Twig для программистов</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, OSCLab.com
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Содержание
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Расширения в Twig</a><ul>
<li><a class="reference internal" href="#globals">Globals</a></li>
<li><a class="reference internal" href="#filters">Filters</a><ul>
<li><a class="reference internal" href="#environment-aware-filters">Environment-aware Filters</a></li>
<li><a class="reference internal" href="#context-aware-filters">Context-aware Filters</a></li>
<li><a class="reference internal" href="#automatic-escaping">Automatic Escaping</a></li>
<li><a class="reference internal" href="#variadic-filters">Variadic Filters</a></li>
<li><a class="reference internal" href="#dynamic-filters">Dynamic Filters</a></li>
<li><a class="reference internal" href="#deprecated-filters">Deprecated Filters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functions">Functions</a></li>
<li><a class="reference internal" href="#tests">Tests</a></li>
<li><a class="reference internal" href="#tags">Tags</a><ul>
<li><a class="reference internal" href="#registering-a-new-tag">Registering a new tag</a></li>
<li><a class="reference internal" href="#defining-a-token-parser">Defining a Token Parser</a></li>
<li><a class="reference internal" href="#defining-a-node">Defining a Node</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-an-extension">Creating an Extension</a><ul>
<li><a class="reference internal" href="#id1">Globals</a></li>
<li><a class="reference internal" href="#id2">Functions</a></li>
<li><a class="reference internal" href="#id3">Filters</a></li>
<li><a class="reference internal" href="#id4">Tags</a></li>
<li><a class="reference internal" href="#operators">Operators</a></li>
<li><a class="reference internal" href="#id5">Tests</a></li>
<li><a class="reference internal" href="#definition-vs-runtime">Definition vs Runtime</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-an-extension">Testing an Extension</a><ul>
<li><a class="reference internal" href="#functional-tests">Functional Tests</a></li>
<li><a class="reference internal" href="#node-tests">Node Tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/main.js"></script>
    <script src="_static/translations.js"></script>
    </body>
</html>